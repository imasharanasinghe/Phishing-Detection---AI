<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Account</title>
  <link rel="stylesheet" href="styles.css?v=auth1">
  <style>
    :root{--blue:#2a4a78;--navy:#042d64;--accent:#ff7c01}
    body{background:#213555;color:#1e293b;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .shell{min-height:100vh;display:grid;place-items:center;padding:2rem}
    .card{width:100%;max-width:460px;background:#fff;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.25);padding:1.75rem}
    .title{font-size:1.75rem;font-weight:700;color:var(--navy);text-align:center;margin-bottom:.25rem}
    .subtitle{font-size:.95rem;color:#6b7280;text-align:center;margin-bottom:1.25rem}
    .field{margin-bottom:1rem}
    .label{display:block;font-size:.9rem;font-weight:600;margin-bottom:.4rem;color:#334155}
    .input-wrap{position:relative}
    .input{width:100%;padding:.85rem 2.75rem .85rem 1rem;border:none;border-radius:10px;background:#e8f0fe;color:#111827;font-size:.95rem;transition:.2s}
    .input:hover{background:#dce9ff}
    .input:focus{outline:none;background:#d2e2ff;box-shadow:0 0 0 2px rgba(42,74,120,.25)}
    .eye{position:absolute;right:.6rem;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;padding:.25rem;color:#334155}
    .eye svg{width:20px;height:20px}
    .err{display:none;color:#b91c1c;font-size:.8rem;margin-top:.4rem}
    .btn{width:100%;padding:.9rem 1rem;border:none;border-radius:10px;background:var(--blue);color:#fff;font-weight:700;cursor:pointer;transition:.2s}
    .btn:hover{filter:brightness(1.05)}
    .foot{text-align:center;margin-top:1rem;font-size:.9rem;color:#6b7280}
    .foot a{color:var(--blue);font-weight:700;text-decoration:none}
    .modal-backdrop{position:fixed;inset:0;background:rgba(4,45,100,.5);backdrop-filter:blur(6px);display:none;align-items:center;justify-content:center}
    .modal{background:rgba(255,255,255,.95);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.35);padding:2rem;width:100%;max-width:420px;text-align:center;transform:scale(.95);opacity:0;transition:.25s}
    .modal.on{transform:scale(1);opacity:1}
    .check{width:56px;height:56px;border-radius:50%;display:inline-grid;place-items:center;background:var(--blue);color:#fff;margin-bottom:.5rem}
    .confetti{position:absolute;inset:0;pointer-events:none;overflow:hidden}
    .toast{display:none;margin-bottom:.75rem;padding:.75rem;border-radius:10px;font-size:.9rem}
    .toast.err{display:block;background:#fef2f2;color:#b91c1c}
    .two-col{display:grid;grid-template-columns:1.1fr .9fr;gap:0;overflow:hidden;border-radius:16px}
    .left-pane{display:none}
    .left-pane img{width:100%;height:100%;object-fit:cover}
    @media(min-width:900px){.card{padding:0}.two-col{max-width:900px}.left-pane{display:block;background:#0b1e3d}}
    .right-pane{padding:1.75rem}
    .google{width:100%;margin-top:.75rem;display:flex;align-items:center;justify-content:center;gap:.5rem;border:1px solid #e5e7eb;border-radius:10px;padding:.8rem;cursor:pointer;background:#fff;color:#111827;font-weight:700}
    .google img{width:18px;height:18px}
  </style>
</head>
<body>
  <div class="shell">
    <div class="card two-col">
      <div class="left-pane"><img src="Photos/signup.png" alt="Sign up"/></div>
      <div class="right-pane">
      <div class="title">Create Account</div>
      <div class="subtitle">Start your free trial today</div>
      <div id="toast" class="toast"></div>
      <div class="field">
        <label class="label" for="email">Email</label>
        <div class="input-wrap">
          <input id="email" type="email" class="input" autocomplete="email" />
        </div>
        <div id="emailErr" class="err"></div>
      </div>
      <div class="field">
        <label class="label" for="password">Password</label>
        <div class="input-wrap">
          <input id="password" type="password" class="input" autocomplete="new-password" />
          <button id="pwEye" class="eye" aria-label="Show password" type="button">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"/><circle cx="12" cy="12" r="3"/></svg>
          </button>
        </div>
        <div id="passwordErr" class="err"></div>
      </div>
      <div class="field">
        <label class="label" for="confirm">Confirm Password</label>
        <div class="input-wrap">
          <input id="confirm" type="password" class="input" autocomplete="new-password" />
          <button id="cpwEye" class="eye" aria-label="Show password" type="button">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"/><circle cx="12" cy="12" r="3"/></svg>
          </button>
        </div>
        <div id="confirmErr" class="err"></div>
      </div>
      <button id="submit" class="btn">Create Account</button>
      <button id="googleBtn" class="google" type="button"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt=""/> Continue with Google</button>
      <div class="foot">Already have an account? <a href="auth-signin.html">Sign in</a></div>
      </div>
    </div>
  </div>

  <div id="modalWrap" class="modal-backdrop">
    <div class="modal" id="modal">
      <div class="check">✓</div>
      <h3 style="margin:.25rem 0 0;color:#111827">Your account is almost created</h3>
      <p style="color:#6b7280;margin:.25rem 0 0 0">Redirecting to Sign In in <span id="count">4</span>s…</p>
      <div class="confetti" id="confetti"></div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script src="js/auth-common.js?v=2"></script>
  <script>
    const emailEl = document.getElementById('email');
    const pwEl = document.getElementById('password');
    const cpwEl = document.getElementById('confirm');
    const emailErr = document.getElementById('emailErr');
    const passwordErr = document.getElementById('passwordErr');
    const confirmErr = document.getElementById('confirmErr');
    const toast = document.getElementById('toast');

    Auth.togglePasswordVisibility(document.getElementById('pwEye'), pwEl);
    Auth.togglePasswordVisibility(document.getElementById('cpwEye'), cpwEl);

    function setToast(msg){ toast.textContent = msg||''; toast.className = msg ? 'toast err' : 'toast'; }

    function showModal(){
      const wrap = document.getElementById('modalWrap');
      const modal = document.getElementById('modal');
      wrap.style.display = 'flex';
      requestAnimationFrame(()=>modal.classList.add('on'));
      // simple confetti dots
      const cf = document.getElementById('confetti');
      for(let i=0;i<40;i++){
        const s = document.createElement('span');
        const size = 6 + Math.random()*6;
        s.style.cssText = `position:absolute;width:${size}px;height:${size}px;border-radius:50%;background:${i%3? '#2a4a78' : (i%5? '#ff7c01' : '#042d64')};left:${Math.random()*100}% ;top:0;transform:translateY(-10px);opacity:.9;`;
        cf.appendChild(s);
        const dur = 1500 + Math.random()*1500;
        s.animate([{transform:'translateY(-10px)',opacity:.9},{transform:'translateY(110vh)',opacity:0}],{duration:dur,fill:'forwards',delay:Math.random()*400});
      }
      let t=4; const el=document.getElementById('count');
      const iv=setInterval(()=>{t--; el.textContent=String(t); if(t<=0){clearInterval(iv); location.href='auth-signin.html';}},1000);
    }

    document.getElementById('submit').addEventListener('click', async ()=>{
      setToast('');
      Auth.showInlineError(emailErr,'');
      Auth.showInlineError(passwordErr,'');
      Auth.showInlineError(confirmErr,'');

      const email = emailEl.value.trim();
      const pw = pwEl.value; const cpw = cpwEl.value;
      let ok=true;
      if(!Auth.validateEmail(email)){ Auth.showInlineError(emailErr,'Enter a valid email'); ok=false; }
      if(!Auth.validatePassword(pw)){ Auth.showInlineError(passwordErr,'Min 8 chars with upper, lower and a number'); ok=false; }
      if(pw!==cpw){ Auth.showInlineError(confirmErr,'Passwords must match'); ok=false; }
      if(!ok) return;
      try{
        await Auth.postJSON('/api/auth/signup',{ email, password: pw });
        // after success, go to Sign In page
        location.href = 'auth-signin.html';
      }catch(e){
        const msg = e?.message || e?.detail?.message || (e?.detail?.field? `${e.detail.field}: ${e.detail.message}`: 'Signup failed');
        setToast(msg);
      }
    });

    // Google with backend fallback
    document.getElementById('googleBtn').addEventListener('click', async () => {
      try{
        const provider = new firebase.auth.GoogleAuthProvider();
        const result = await firebase.auth().signInWithPopup(provider);
        // Save email for dashboard offline fallback
        localStorage.setItem('AUTH_EMAIL', result?.user?.email || '');
        try {
          const idToken = await result.user.getIdToken();
          const r = await Auth.postJSON('/api/auth/google', { token: idToken });
          if (r?.token) localStorage.setItem('JWT', r.token);
        } catch (be) {
          localStorage.setItem('JWT', 'mock_google_jwt_' + Date.now());
        }
        location.href = 'dashboard.html';
      }catch(e){ setToast(e?.message || 'Google sign-up failed'); }
    });
  </script>
  <script src="chatbot.js?v=3"></script>
</body>
</html>
